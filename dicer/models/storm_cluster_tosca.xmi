<?xml version="1.0" encoding="ASCII"?>
<tosca:TopologyTemplate xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:tosca="http://tosca/1.0" tosca_definitions_version="cloudify_dsl_1_1">
  <imports file="http://www.getcloudify.org/spec/cloudify/3.3.1/types.yaml"/>
  <imports file="https://raw.githubusercontent.com/dice-project/DICE-FCO-Plugin-Cloudify//plugin.yaml"/>
  <imports file="http://www.getcloudify.org/spec/chef-plugin/1.3.1/plugin.yaml"/>
  <imports file="http://dice-project.github.io/DICE-Deployment-Cloudify/spec///plugin.yaml"/>
  <imports file="types/dice.yaml"/>
  <nodeTemplates node_template_name="vmq" type="dice.hosts.small">
    <properties property_name="instances" value="3"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="vm2" type="dice.hosts.large">
    <properties property_name="instances" value="1"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="vm3" type="dice.hosts.medium">
    <properties property_name="instances" value="2"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="nimbus_hosts" type="dice.hosts.large">
    <properties property_name="instances" value="1"/>
    <relationships type="dice.server_connected_to_virtual_ip" target="nimbus_hosts_virtual_ip"/>
    <relationships type="dice.server_connected_to_firewall" target="nimbus_hosts_virtual_ip"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="zookeeper_hosts" type="dice.hosts.medium">
    <properties property_name="instances" value="2"/>
    <relationships type="dice.server_connected_to_virtual_ip" target="zookeeper_hosts_virtual_ip"/>
    <relationships type="dice.server_connected_to_firewall" target="zookeeper_hosts_virtual_ip"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_zookeeper_server" type="dice.components.zookeeper.Server">
    <properties property_name="tickTime" value="1000"/>
    <properties property_name="initLimit" value="1000"/>
    <properties property_name="syncLimit" value="1000"/>
    <relationships type="cloudify.relationships.contained_in" target="zookeeper_hosts">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="create" primary="scripts/configure_zookeeper_host.sh"/>
      </source_interfaces>
    </relationships>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_zookeeper_quorum" type="dice.components.zookeeper.Quorum">
    <relationships type="dice.relationships.zookeeper.QuorumContains" target="zookeeper_hosts"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_nimbus" type="dice.components.storm.Nimbus">
    <properties property_name="taskTimeout" value="30"/>
    <properties property_name="supervisorTimeout" value="60"/>
    <properties property_name="monitorFrequency" value="10"/>
    <properties property_name="queueSize" value="100000"/>
    <properties property_name="retryTimes" value="5"/>
    <properties property_name="retryInterval" value="2000"/>
    <relationships type="cloudify.relationships.contained_in" target="nimbus_hosts">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="create" primary="scripts/configure_nimbus_host.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_zookeeper_server">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_zookeeper.sh"/>
      </source_interfaces>
    </relationships>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_vmq_storm_supervisor" type="dice.components.storm.Worker">
    <properties property_name="workerStartTimeout" value="120"/>
    <properties property_name="heartbeatFrequency" value="5"/>
    <properties property_name="cpuCapacity" value="400"/>
    <properties property_name="memoryCapacity" value="4096"/>
    <relationships type="cloudify.relationships.contained_in" target="vmq">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="create" primary="scripts/configure_supervisor_host.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_zookeeper_server">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_zookeeper.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_nimbus">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_nimbus.sh"/>
      </source_interfaces>
    </relationships>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_vm2_storm_supervisor" type="dice.components.storm.Worker">
    <properties property_name="workerStartTimeout" value="120"/>
    <properties property_name="heartbeatFrequency" value="5"/>
    <properties property_name="cpuCapacity" value="400"/>
    <properties property_name="memoryCapacity" value="4096"/>
    <relationships type="cloudify.relationships.contained_in" target="vm2">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="create" primary="scripts/configure_supervisor_host.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_zookeeper_server">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_zookeeper.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_nimbus">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_nimbus.sh"/>
      </source_interfaces>
    </relationships>
  </nodeTemplates>
  <nodeTemplates node_template_name="my_storm_cluster_vm3_storm_supervisor" type="dice.components.storm.Worker">
    <properties property_name="workerStartTimeout" value="120"/>
    <properties property_name="heartbeatFrequency" value="5"/>
    <properties property_name="cpuCapacity" value="400"/>
    <properties property_name="memoryCapacity" value="4096"/>
    <relationships type="cloudify.relationships.contained_in" target="vm3">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="create" primary="scripts/configure_supervisor_host.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_zookeeper_server">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_zookeeper.sh"/>
      </source_interfaces>
    </relationships>
    <relationships type="cloudify.relationships.connected_to" target="my_storm_cluster_nimbus">
      <source_interfaces type="cloudify.interfaces.lifecycle">
        <operations operation_name="preconfigure" primary="scripts/connect_to_nimbus.sh"/>
      </source_interfaces>
    </relationships>
  </nodeTemplates>
</tosca:TopologyTemplate>
