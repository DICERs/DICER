<?xml version="1.0" encoding="ASCII"?>
<tosca:TopologyTemplate xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tosca="http://tosca/1.0" tosca_definitions_version="cloudify_dsl_1_3">
  <imports file="http://dice-project.github.io/DICE-Deployment-Cloudify/spec/fco/0.2.5/plugin.yaml"/>
  <outputs parameter_name="storm1_vm_ip_output">
    <parameter_value xsi:type="tosca:GetAttribute" node="storm1_vm" attribute="ip"/>
  </outputs>
  <outputs parameter_name="cassandra1_vm_ip_output">
    <parameter_value xsi:type="tosca:GetAttribute" node="cassandra1_vm" attribute="ip"/>
  </outputs>
  <outputs parameter_name="zookeeper1_vm_ip_output">
    <parameter_value xsi:type="tosca:GetAttribute" node="zookeeper1_vm" attribute="ip"/>
  </outputs>
  <nodeTemplates node_template_name="storm1_vm" type="dice.hosts.Medium">
    <relationships type="dice.relationships.ProtectedBy" target="storm1_firewall"/>
    <relationships type="dice.relationships.IPAvailableFrom" target="storm1_vm_ip"/>
    <instances deploy="2"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="storm1_vm_ip" type="dice.VirtualIP"/>
  <nodeTemplates node_template_name="cassandra1_vm" type="dice.hosts.Medium">
    <relationships type="dice.relationships.ProtectedBy" target="cassandra1_firewall"/>
    <relationships type="dice.relationships.IPAvailableFrom" target="cassandra1_vm_ip"/>
    <instances deploy="2"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="cassandra1_vm_ip" type="dice.VirtualIP"/>
  <nodeTemplates node_template_name="zookeeper1_vm" type="dice.hosts.Medium">
    <relationships type="dice.relationships.ProtectedBy" target="zookeeper1_firewall"/>
    <relationships type="dice.relationships.IPAvailableFrom" target="zookeeper1_vm_ip"/>
    <instances deploy="1"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="zookeeper1_vm_ip" type="dice.VirtualIP"/>
  <nodeTemplates node_template_name="cassandra1_worker" type="dice.components.cassandra.Worker">
    <relationships type="dice.relationships.ContainedIn" target="cassandra1_vm"/>
    <relationships type="dice.relationships.cassandra.ConnectedToSeed" target="cassandra1"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="cassandra1" type="dice.components.cassandra.Seed">
    <relationships type="dice.relationships.ContainedIn" target="cassandra1_seed_vm"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="cassandra1_firewall" type="dice.firewall_rules.cassandra.Common"/>
  <nodeTemplates node_template_name="cassandra1_seed_vm" type="dice.hosts.Medium">
    <relationships type="dice.relationships.ProtectedBy" target="cassandra1_firewall"/>
    <relationships type="dice.relationships.IPAvailableFrom" target="cassandra1_seed_vm_ip"/>
    <instances deploy="1"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="cassandra1_seed_vm_ip" type="dice.VirtualIP"/>
  <nodeTemplates node_template_name="zookeeper1" type="dice.components.zookeeper.Server">
    <relationships type="dice.relationships.ContainedIn" target="zookeeper1_vm"/>
    <relationships type="dice.relationships.zookeeper.MemberOfQuorum" target="zookeeper1_quorum"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="zookeeper1_firewall" type="dice.firewall_rules.zookeeper.Server"/>
  <nodeTemplates node_template_name="zookeeper1_quorum" type="dice.components.zookeeper.Quorum">
    <relationships type="dice.relationships.zookeeper.QuorumContains" target="zookeeper1_vm"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="storm1_master" type="dice.components.storm.Nimbus">
    <relationships type="dice.relationships.ContainedIn" target="storm1_master_vm"/>
    <relationships type="dice.relationships.storm.ConnectedToZookeeperQuorum" target="zookeeper1_quorum"/>
    <configurations property_name="taskTimeout" value="60"/>
    <configurations property_name="supervisorFrequency" value="60"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="storm1" type="dice.components.storm.Worker">
    <relationships type="dice.relationships.ContainedIn" target="storm1_vm"/>
    <relationships type="dice.relationships.storm.ConnectedToZookeeperQuorum" target="zookeeper1_quorum"/>
    <relationships type="dice.relationships.storm.ConnectedToNimbus" target="storm1_master"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="storm1_master_firewall" type="dice.firewall_rules.storm.Nimbus"/>
  <nodeTemplates node_template_name="storm1_firewall" type="dice.firewall_rules.storm.Worker"/>
  <nodeTemplates node_template_name="storm1_master_vm" type="dice.hosts.Medium">
    <relationships type="dice.relationships.ProtectedBy" target="storm1_master_firewall"/>
    <relationships type="dice.relationships.IPAvailableFrom" target="storm1_master_vm_ip"/>
    <instances deploy="1"/>
  </nodeTemplates>
  <nodeTemplates node_template_name="storm1_master_vm_ip" type="dice.VirtualIP"/>
  <nodeTemplates node_template_name="wikistats" type="dice.components.storm.Topology">
    <properties property_name="application" value="http://193.77.50.17/html/dice-wikistats/wikistats-topology-0.1.0-SNAPSHOT.jar"/>
    <properties property_name="topology_class" value="dice.test.WikiTopology"/>
    <properties property_name="topology_name" value="wikistats"/>
    <relationships type="dice.relationships.Needs" target="storm1"/>
    <relationships type="dice.relationships.storm.SubmittedBy" target="storm1_master"/>
    <relationships type="dice.relationships.Needs" target="cassandra1"/>
    <arguments>
      <argument_value xsi:type="tosca:GetAttribute" node="cassandra1" attribute="ip"/>
    </arguments>
    <arguments>
      <argument_value xsi:type="tosca:SimpleValue" value="https://dumps.wikimedia.org/enwiki/20160820/enwiki-20160820-pages-articles1.xml-p000000010p000030302.bz2"/>
    </arguments>
  </nodeTemplates>
</tosca:TopologyTemplate>
